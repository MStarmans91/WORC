

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>User Manual &mdash; WORC 3.6.3 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Configuration" href="configuration.html" />
    <link rel="prev" title="Quick start guide" href="quick_start.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> WORC
          

          
            
            <img src="../_static/WORC_Logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.6.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick start guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#worc-facades">WORC facades</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simpleworc">SimpleWORC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basicworc">BasicWORC</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#input-file-definitions-and-how-to-provide-them-to-worc">Input file definitions and how to provide them to WORC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#providing-your-inputs-to-worc-and-data-flows">Providing your inputs to WORC and data flows</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-multiple-sources-per-patient">Using multiple sources per patient</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mutiple-rois-or-segmentations-per-object-patient">Mutiple ROIs or segmentations per object/patient</a></li>
<li class="toctree-l4"><a class="reference internal" href="#training-and-test-sets">Training and test sets</a></li>
<li class="toctree-l4"><a class="reference internal" href="#missing-data-and-dummy-s">Missing data and dummy’s</a></li>
<li class="toctree-l4"><a class="reference internal" href="#segmentation-on-the-first-image-but-not-on-the-others">Segmentation on the first image, but not on the others</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#images-and-segmentations">Images and segmentations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#labels">Labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="#semantics-or-non-radiomics-features">Semantics or non-radiomics features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#masks">Masks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#metadata">Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#elastix-para">Elastix_Para</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#outputs-and-evaluation-of-your-network">Outputs and evaluation of your network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debugging">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-data">Example data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#worc">WORC</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Radiomics Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="additionalfunctionality.html">Additional functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="developerdocumentation.html">Developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../autogen/WORC.html">WORC Package</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WORC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>User Manual</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/static/user_manual.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-manual">
<h1>User Manual<a class="headerlink" href="#user-manual" title="Permalink to this headline">¶</a></h1>
<p>In this chapter we will discuss the parts of WORC in more detail, mostly focussed on facades,
the inputs you can provide to WORC, the outputs, and the various workflow possible. We will
give a more complete overview of the system and describe the more advanced features.</p>
<p>We will not discuss the <code class="docutils literal notranslate"><span class="pre">WORC.defaultconfig()</span></code> function here, which generates the default
configuration, as it is discussed on a separate page, see the <a class="reference internal" href="configuration.html#config-chapter"><span class="std std-ref">Config chapter</span></a>.</p>
<div class="section" id="worc-facades">
<span id="tools"></span><h2>WORC facades<a class="headerlink" href="#worc-facades" title="Permalink to this headline">¶</a></h2>
<p>The WORC toolbox is build around of one main object, the <code class="docutils literal notranslate"><span class="pre">WORC</span></code> object. This object provides all functionality
of the toolbox. However, to make certain functionalities easier to use and limit the complexity,
we have constructed two facades: <code class="docutils literal notranslate"><span class="pre">SimpleWORC</span></code> and <code class="docutils literal notranslate"><span class="pre">BasicWORC</span></code>. We advice new users to start with <code class="docutils literal notranslate"><span class="pre">SimpleWORC</span></code>,
more advanced users <code class="docutils literal notranslate"><span class="pre">BasicWORC</span></code>, and only use <code class="docutils literal notranslate"><span class="pre">WORC</span></code> for development purposes. Additionally, we advice you to take a look at the <a class="reference internal" href="configuration.html#config-chapter"><span class="std std-ref">configuration chapter</span></a>
for all the settings that can be adjusted in WORC. We give a short description of the two facades here.</p>
<div class="section" id="simpleworc">
<h3>SimpleWORC<a class="headerlink" href="#simpleworc" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">SimpleWORC</span></code> facade is the simplest to interact with and provides
all functionality required for conducting basic experiments.
Much of the documentation of <code class="docutils literal notranslate"><span class="pre">SimpleWORC</span></code> can be found in its tutorial (<a class="reference external" href="https://github.com/MStarmans91/WORCtutorial">https://github.com/MStarmans91/WORCtutorial</a> and
<a class="reference internal" href="quick_start.html#quickstart-chapter"><span class="std std-ref">the quick start</span></a>) and the docstrings of the functions in the object (<a class="reference internal" href="../autogen/WORC.facade.html#module-WORC.facade.simpleworc" title="WORC.facade.simpleworc"><code class="xref py py-mod docutils literal notranslate"><span class="pre">WORC.facade.simpleworc</span></code></a>).
Many of the functions are  wrappers to interact with the <code class="docutils literal notranslate"><span class="pre">WORC</span></code> object, and therefore in the background use the functionality described below.</p>
</div>
<div class="section" id="basicworc">
<h3>BasicWORC<a class="headerlink" href="#basicworc" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">BasicWORC</span></code> object is based on the <code class="docutils literal notranslate"><span class="pre">SimpleWORC</span></code> object, and thus provides exactly the same functionality,
plus several more advances functions. Much of the documentation of <code class="docutils literal notranslate"><span class="pre">BasicWORC</span></code> can be found in its tutorial (<a class="reference external" href="https://github.com/MStarmans91/WORCtutorial">https://github.com/MStarmans91/WORCtutorial</a>)
and the docstrings of the functions in the object (<a class="reference internal" href="../autogen/WORC.facade.html#module-WORC.facade.basicworc" title="WORC.facade.basicworc"><code class="xref py py-mod docutils literal notranslate"><span class="pre">WORC.facade.basicworc</span></code></a>).</p>
<p>One of the functionalities that <code class="docutils literal notranslate"><span class="pre">BasicWORC</span></code> provides over <code class="docutils literal notranslate"><span class="pre">SimpleWORC</span></code> is that you can also directly provide
your data to <code class="docutils literal notranslate"><span class="pre">WORC</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">images_train</span></code>) instead of using one of the wrapping functions of
<code class="docutils literal notranslate"><span class="pre">SimpleWORC</span></code> (e.g. <a href="#id1"><span class="problematic" id="id2">``</span></a>images_from_this_directory)</p>
</div>
</div>
<div class="section" id="input-file-definitions-and-how-to-provide-them-to-worc">
<span id="inputs"></span><h2>Input file definitions and how to provide them to WORC<a class="headerlink" href="#input-file-definitions-and-how-to-provide-them-to-worc" title="Permalink to this headline">¶</a></h2>
<div class="section" id="providing-your-inputs-to-worc-and-data-flows">
<h3>Providing your inputs to WORC and data flows<a class="headerlink" href="#providing-your-inputs-to-worc-and-data-flows" title="Permalink to this headline">¶</a></h3>
<p>Let’s first start on how to provide any of the below mentioned types of input data to  <code class="docutils literal notranslate"><span class="pre">WORC</span></code>.
<code class="docutils literal notranslate"><span class="pre">WORC</span></code> facilitates different data flows (or networks or pipelines), which are automatically
constructed based on the inputs and configuration you provide. We here
discuss how the data can be set in <code class="docutils literal notranslate"><span class="pre">BasicWORC</span></code> and <code class="docutils literal notranslate"><span class="pre">WORC</span></code>:
<code class="docutils literal notranslate"><span class="pre">SimpleWORC</span></code> provides several wrappers to more easily provide data, which interact with
thee objects.</p>
<p>As an example, we here show how to provide images and segmentations to <code class="docutils literal notranslate"><span class="pre">BasicWORC</span></code> and <code class="docutils literal notranslate"><span class="pre">WORC</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">images1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/image_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient2&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient2/image_MR.nii.gz&#39;</span><span class="p">}</span>
<span class="n">segmentations1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/seg_tumor_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient2&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient2/seg_tumor_MR.nii.gz&#39;</span><span class="p">}</span>

<span class="n">experiment</span><span class="o">.</span><span class="n">images_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images1</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">segmentations_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segmentations1</span><span class="p">)</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">network</span></code> can be a <code class="docutils literal notranslate"><span class="pre">BasicWORC</span></code> or <code class="docutils literal notranslate"><span class="pre">WORC</span></code> object. Each source is a list, to which you can provide
dictionaries containing the actual sources. In these dictionaries, each element should correspond to a single
object for classification, e.g., a patient or a lesions. The keys indicate
the ID of the element, e.g. the patient name, while the values should be strings corresponding to
the source filenames. The keys are used to match the images and segmentations to the
label and semantics sources, so make sure these correspond to the label file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You have to make sure the images and segmentation (and other) sources match in size,
i.e., that the same keys are present.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You have to supply a configuration file for each image or feature source you append.
Thus, in the first example above, you need to append two configurations!</p>
</div>
<div class="section" id="using-multiple-sources-per-patient">
<h4>Using multiple sources per patient<a class="headerlink" href="#using-multiple-sources-per-patient" title="Permalink to this headline">¶</a></h4>
<p>If you want to provide multiple sources, e.g. images, per patient, simply append another dictionary
to the source list, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">images1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/image_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient2&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient2/image_MR.nii.gz&#39;</span><span class="p">}</span>
<span class="n">images2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/image_CT.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient2&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient2/image_CT.nii.gz&#39;</span><span class="p">}</span>
<span class="n">segmentations1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/seg_tumor_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient2&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient2/seg_tumor_MR.nii.gz&#39;</span><span class="p">}</span>
<span class="n">segmentations2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/seg_tumor_CT.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient2&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient2/seg_tumor_CT.nii.gz&#39;</span><span class="p">}</span>

<span class="n">experiment</span><span class="o">.</span><span class="n">images_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images1</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">images_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images2</span><span class="p">)</span>

<span class="n">experiment</span><span class="o">.</span><span class="n">segmentations_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segmentations1</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">segmentations_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segmentations2</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">WORC</span></code> will use the keys of the dictionaries to match the features from the same object or patient and combine
them for the machine learning part.</p>
</div>
<div class="section" id="mutiple-rois-or-segmentations-per-object-patient">
<h4>Mutiple ROIs or segmentations per object/patient<a class="headerlink" href="#mutiple-rois-or-segmentations-per-object-patient" title="Permalink to this headline">¶</a></h4>
<p>You can off course have multiple images or ROIs per object, e.g. a liver
ROI and a tumor ROI. This can be easily done by appending to the
sources. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">images1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/image_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient2&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient2/image_MR.nii.gz&#39;</span><span class="p">}</span>
<span class="n">segmentations1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/seg_tumor_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient2&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient2/seg_tumor_MR.nii.gz&#39;</span><span class="p">}</span>
<span class="n">segmentations2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/seg_liver_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient2&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient2/seg_liver_MR.nii.gz&#39;</span><span class="p">}</span>

<span class="n">experiment</span><span class="o">.</span><span class="n">images_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images1</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">images_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images1</span><span class="p">)</span>

<span class="n">experiment</span><span class="o">.</span><span class="n">segmentations_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segmentations1</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">segmentations_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segmentations2</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">WORC</span></code> will use the keys of the dictionaries to match the features from the same object or patient and combine
them for the machine learning part.</p>
<p>If you want to use multiple ROIs independently per patient, e.g. multiple tumors, you can do so
by simply adding them to the dictionary. To make sure the data is still split per patient in the
cross-validation, please add a sample number after an underscore to the key, e.g.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">images1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1_0&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/image_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient1_1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/image_MR.nii.gz&#39;</span><span class="p">}</span>
<span class="n">segmentations1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1_0&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/seg_tumor1_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient1_1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/seg_tumor2_MR.nii.gz&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>If your label file (see below) contains the label ‘’patient1’’, both samples will get this label
in the classification.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">WORC</span></code> will automatically group all samples from a patient either all in the training
or all in the test set.</p>
</div>
</div>
<div class="section" id="training-and-test-sets">
<h4>Training and test sets<a class="headerlink" href="#training-and-test-sets" title="Permalink to this headline">¶</a></h4>
<p>When using a single dataset for both training and evaluation, you should
only supply “training” datasets. By default, performance on a single
dataset will be evaluated using cross-validation (default random split, but leave-one-out can also be configured).</p>
<p>Alternatively, you can supply a separate training and test set, by which you tell
<code class="docutils literal notranslate"><span class="pre">WORC</span></code> to use this single train-test split. To distinguish between these, for every source, we have a
train and test object which you can set.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using a separate train and test set, you always need to provide a training and test label file as well.
These can refer to the same CSV / Excel file.</p>
</div>
<p>When using <code class="docutils literal notranslate"><span class="pre">SimpleWORC</span></code> or <code class="docutils literal notranslate"><span class="pre">BasicWORC</span></code>, you can do
this through the same function as the training set, but setting  <code class="docutils literal notranslate"><span class="pre">is_training=False</span></code>, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">images_from_this_directory</span><span class="p">(</span><span class="n">testimagedatadir</span><span class="p">,</span>
                                      <span class="n">image_file_name</span><span class="o">=</span><span class="n">image_file_name</span><span class="p">,</span>
                                      <span class="n">is_training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>When using the <code class="docutils literal notranslate"><span class="pre">WORC</span></code> object, or directly setting your sources in <code class="docutils literal notranslate"><span class="pre">BasicWORC</span></code>, this would look like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">images_train</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/image_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient2&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient2/image_MR.nii.gz&#39;</span><span class="p">}</span>
<span class="n">segmentations_train</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/seg_tumor_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient2&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient2/seg_tumor_MR.nii.gz&#39;</span><span class="p">}</span>

<span class="n">experiment</span><span class="o">.</span><span class="n">images_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images_train</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">segmentations_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segmentations_train</span><span class="p">)</span>

<span class="n">images_test</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient3&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient3/image_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient4&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient4/image_MR.nii.gz&#39;</span><span class="p">}</span>
<span class="n">segmentations_test</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient3&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient3/seg_tumor_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient4&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient4/seg_tumor_MR.nii.gz&#39;</span><span class="p">}</span>

<span class="n">experiment</span><span class="o">.</span><span class="n">images_test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images_test</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">segmentations_test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segmentations_test</span><span class="p">)</span>

<span class="c1"># In this example, we provide the same label file for both the training and test set, but these can be independent</span>
<span class="n">label_file</span> <span class="o">=</span> <span class="s1">&#39;/data/label_file.csv&#39;</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">labels_from_this_file</span><span class="p">(</span><span class="n">label_file</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">labels_from_this_file</span><span class="p">(</span><span class="n">label_file</span><span class="p">,</span> <span class="n">is_training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Another alternative is to only provide training objects, but also a .csv defining fixed training and test splits to be used for the
evaluation, e.g. <code class="docutils literal notranslate"><span class="pre">experiment.fixed_splits</span> <span class="pre">=</span> <span class="pre">'/data/fixedsplits.csv</span></code>. See the <a class="reference external" href="https://github.com/MStarmans91/WORCtutorial">https://github.com/MStarmans91/WORCtutorial</a> repository for an example. <code class="docutils literal notranslate"><span class="pre">SimpleWORC</span></code> has the <code class="docutils literal notranslate"><span class="pre">set_fixed_splits</span></code> to set this object.</p>
</div>
<div class="section" id="missing-data-and-dummy-s">
<h4>Missing data and dummy’s<a class="headerlink" href="#missing-data-and-dummy-s" title="Permalink to this headline">¶</a></h4>
<p>Suppose you are missing a specific image for a specific patient. <code class="docutils literal notranslate"><span class="pre">WORC</span></code> can impute the features of this patient.
The underlying package we use for workflow execution (fastr) can however handle missing data. Therefore, to tell <code class="docutils literal notranslate"><span class="pre">WORC</span></code> to
do so, you still have to provide a source but can add ‘’Dummy’’ to the key:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">images1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patientc/image_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient2_Dummy&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/image_MR.nii.gz&#39;</span><span class="p">}</span>
<span class="n">segmentations1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/seg_tumor_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient2_Dummy&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/seg_tumor_MR.nii.gz&#39;</span><span class="p">}</span>

<span class="n">experiment</span><span class="o">.</span><span class="n">images_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images1</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">segmentations_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segmentations1</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">WORC</span></code>  will process the sources normally up till the imputation part, so you have to provide valid data. As you see in the example above,
we simply provided data from another patient.</p>
</div>
<div class="section" id="segmentation-on-the-first-image-but-not-on-the-others">
<h4>Segmentation on the first image, but not on the others<a class="headerlink" href="#segmentation-on-the-first-image-but-not-on-the-others" title="Permalink to this headline">¶</a></h4>
<p>When you use multiple image sequences, you can supply a ROI for each sequence by
appending to to segmentations object as above. Alternatively, when you do not
supply a segmentation for a specific sequence, <code class="docutils literal notranslate"><span class="pre">WORC</span></code> will use elastix (<a class="reference external" href="https://github.com/SuperElastix/elastix">https://github.com/SuperElastix/elastix</a>)
to align this sequence to another through image registration. It will then
warp the segmentation from this sequence to the sequence for which you
did not supply a segmentation. <strong>WORC will always align these sequences with no segmentations to the first sequence, i.e. the first object in the images_train list.</strong>
Hence make sure you supply the sequence for which you have a ROI as the first object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">images1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/image_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient2&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient2/image_MR.nii.gz&#39;</span><span class="p">}</span>
<span class="n">images2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/image_CT.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient2&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient2/image_CT.nii.gz&#39;</span><span class="p">}</span>
<span class="n">segmentations1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient1/seg_tumor_MR.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;patient2&#39;</span><span class="p">:</span> <span class="s1">&#39;/data/Patient2/seg_tumor_MR.nii.gz&#39;</span><span class="p">}</span>

<span class="n">experiment</span><span class="o">.</span><span class="n">images_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images1</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">images_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images2</span><span class="p">)</span>

<span class="n">experiment</span><span class="o">.</span><span class="n">segmentations_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segmentations1</span><span class="p">)</span>
</pre></div>
</div>
<p>When providing only a segmentation for the first image in this way, <code class="docutils literal notranslate"><span class="pre">WORC</span></code> will automatically
recognize that it needs to use registration.</p>
</div>
</div>
<div class="section" id="images-and-segmentations">
<h3>Images and segmentations<a class="headerlink" href="#images-and-segmentations" title="Permalink to this headline">¶</a></h3>
<p>The minimal input for a radiomics pipeline consists of either images
plus segmentations, or features, plus a label file (and a configuration,
but you can just use the default one).</p>
<p>If you supply images and segmentations, features will be computed within the segmentations
on the images. They are read out using SimpleITK, which supports various
image formats such as DICOM, NIFTI, TIFF, NRRD and MHD.</p>
</div>
<div class="section" id="labels">
<span id="um-labels"></span><h3>Labels<a class="headerlink" href="#labels" title="Permalink to this headline">¶</a></h3>
<p>The labels are predicted in the classification: should be a .txt or .csv file.
The first column should head <code class="docutils literal notranslate"><span class="pre">Patient</span></code> and contain the patient ID. The next columns
can contain labels you want to predict, e.g. tumor type, risk, genetics. For example:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 38%" />
<col style="width: 31%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Patient</p></th>
<th class="head"><p>Label1</p></th>
<th class="head"><p>Label2</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>patient1</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>patient2</p></td>
<td><p>2</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>patient3</p></td>
<td><p>1</p></td>
<td><p>5</p></td>
</tr>
</tbody>
</table>
<p>These labels are matched to the correct image/features by the sample names of the image/features. So in this
case, your sources should look as following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">images_train</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> <span class="s1">&#39;patient2&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">}</span>
<span class="n">segmentations_train</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patient1&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> <span class="s1">&#39;patient2&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">WORC</span></code> will automatically group all samples from a patient either all in the training
or all in the test set.</p>
</div>
</div>
<div class="section" id="semantics-or-non-radiomics-features">
<h3>Semantics or non-radiomics features<a class="headerlink" href="#semantics-or-non-radiomics-features" title="Permalink to this headline">¶</a></h3>
<p>Semantic features are non-computational features, thus features that you supply instead of extract. Examples include
using the age and sex of the patients in the classification. You can
supply these as a .csv listing your features per patient, similar to the <a class="reference internal" href="#um-labels"><span class="std std-ref">label file</span></a>. See
[the WORCTutorial Github repo](<a class="reference external" href="https://github.com/MStarmans91/WORCTutorial/tree/master/Data/Examplefiles">https://github.com/MStarmans91/WORCTutorial/tree/master/Data/Examplefiles</a>) for an example file.</p>
<p>You can provide these sources either through the <code class="docutils literal notranslate"><span class="pre">set_registration_parameterfile</span></code> function of the facades,
by interacting with the <code class="docutils literal notranslate"><span class="pre">BasicWORC</span></code> <code class="docutils literal notranslate"><span class="pre">elastix_parameter_file</span></code> object, or the
<code class="docutils literal notranslate"><span class="pre">WORC</span></code> <code class="docutils literal notranslate"><span class="pre">Elastix_Para</span></code> object. An example of the first option:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="section" id="masks">
<h3>Masks<a class="headerlink" href="#masks" title="Permalink to this headline">¶</a></h3>
<p>WORC contains a segmentation preprocessing tool, called segmentix.
The idea is that you can manipulate
your segmentation, e.g. using dilation, then use a mask to make sure it
is still valid. See the <a class="reference internal" href="configuration.html#config-chapter"><span class="std std-ref">config chapter</span></a> for all segmentix options.</p>
</div>
<div class="section" id="features">
<h3>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h3>
<p>If you already computed your features, e.g. from a previous run, you can
directly supply the features instead of the images and segmentations and
skip the feature computation step. These should be stored in .hdf5 files
matching the WORC format.</p>
</div>
<div class="section" id="metadata">
<h3>Metadata<a class="headerlink" href="#metadata" title="Permalink to this headline">¶</a></h3>
<p>This source can be used if you want to use tags from the DICOM header as
features, e.g. patient age and sex. In this case, this source should
contain a single DICOM per patient from which the tags that are read.
Check the PREDICT.imagefeatures.patient_feature module for the currently
implemented tags.</p>
</div>
<div class="section" id="elastix-para">
<h3>Elastix_Para<a class="headerlink" href="#elastix-para" title="Permalink to this headline">¶</a></h3>
<p>If you have multiple images for each patient, e.g. T1 and T2, but only a
single segmentation, you can use image registration to align and
transform the segmentation to the other modality. This is done in WORC
using elastix (<a class="reference external" href="https://github.com/SuperElastix/elastix">https://github.com/SuperElastix/elastix</a>). In this source, you can supply
a parameter file for Elastix to be used in the registration in .txt.
format. We provide one example parameter file in <code class="docutils literal notranslate"><span class="pre">WORC</span></code> (<a class="reference external" href="https://github.com/MStarmans91/WORC/tree/master/WORC/exampledata">https://github.com/MStarmans91/WORC/tree/master/WORC/exampledata</a>),
see the elastix model zoo for several others (<a class="reference external" href="https://github.com/SuperElastix/ElastixModelZoo/tree/master/models/default">https://github.com/SuperElastix/ElastixModelZoo/tree/master/models/default</a>).</p>
<p>You can provide these sources either through the <code class="docutils literal notranslate"><span class="pre">set_registration_parameterfile</span></code> function of the facades,
by interacting with the <code class="docutils literal notranslate"><span class="pre">BasicWORC</span></code> <code class="docutils literal notranslate"><span class="pre">elastix_parameter_file</span></code> object, or the
<code class="docutils literal notranslate"><span class="pre">WORC</span></code> <code class="docutils literal notranslate"><span class="pre">Elastix_Para</span></code> object. An example of the first option:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="o">.</span><span class="n">set_registration_parameterfile</span><span class="p">(</span><span class="s1">&#39;/exampledata/ParametersRigid.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">WORC</span></code> assumes your segmentation is made on the first
<code class="docutils literal notranslate"><span class="pre">WORC.images_train</span></code> (or test) source you supply. The segmentation
will be alligned to all other image sources.</p>
</div>
</div>
</div>
<div class="section" id="outputs-and-evaluation-of-your-network">
<span id="um-evaluation"></span><h2>Outputs and evaluation of your network<a class="headerlink" href="#outputs-and-evaluation-of-your-network" title="Permalink to this headline">¶</a></h2>
<p>General remark: when we talk about a sample, we mean one sample that has a set of features associated with it and is thus used as such in the model training or evaluation.
A sample can correspond with a single patient, but if you have multiple tumors per patient for which features are separately extracted per tumor, these can be treated as separate sample.</p>
<p>The following outputs and evaluation methods are always generated:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For every output file, fastr generates a provenance file (<code class="docutils literal notranslate"><span class="pre">...prov.json</span></code>) stating how a file was generated, see <a class="reference external" href="https://fastr.readthedocs.io/en/stable/static/user_manual.html#provenance">https://fastr.readthedocs.io/en/stable/static/user_manual.html#provenance</a>.</p>
</div>
<ol class="arabic">
<li><p>Performance of your models (main output).</p>
<blockquote>
<div><p>Stored in file <code class="docutils literal notranslate"><span class="pre">performance_all_{num}.json</span></code>. If you created multiple models to predict multiple labels, or did multilabel classification, the <code class="docutils literal notranslate"><span class="pre">{num}</span></code> corresponds
to the label. The file consists of three parts.</p>
<p><strong>Mean and 95% confidence intervals of several performance metrics.</strong></p>
<p>For classification:</p>
<ol class="loweralpha simple">
<li><p>Area under the curve (AUC) of the receiver operating characteristic (ROC) curve. In a multiclass setting, weuse the multiclass AUC from the <a class="reference external" href="https://tadpole.grand-challenge.org/">TADPOLE Challenge</a>.</p></li>
<li><p>Accuracy.</p></li>
<li><p>Balanced Classification Accuracy (BCA), based on Balanced Classification Rate by <cite>Tharwat, A., 2021. Classification assessment methods. Applied Computing and Informatics 17, 168–192.</cite>.</p></li>
<li><p>F1-score</p></li>
<li><p>Sensitivity or recall or true positive rate</p></li>
<li><p>Specificity or true negative rate</p></li>
<li><p>Negative predictive value (NPV)</p></li>
<li><p>Precision or Positive predictive value (PPV)</p></li>
</ol>
<p>For regression:</p>
<ol class="loweralpha simple">
<li><p>R2-score</p></li>
<li><p>Mean Squared Error (MSE)</p></li>
<li><p>Intraclass Correlation Coefficient (ICC)</p></li>
<li><p>Pearson correlation coefficient and p-value</p></li>
<li><p>Spearman correlation coefficient and p-value</p></li>
</ol>
<p>For survival, in addition to the regression scores:
a. Concordance index
b. Cox regression coefficient and p-value</p>
<p>In cross-validation, by default, 95% confidence intervals for the mean performance measures are constructed using
the corrected resampled t-test base on all cross-validation iterations, thereby taking into account that the samples
in the cross-validation splits are not statistically independent. See als
<cite>Nadeau C, Bengio Y. Inference for the generalization error. In Advances in Neural Information Processing Systems, 2000; 307–313.</cite></p>
<p>In bootstrapping, 95% confidence intervals are created using the ‘’standard’’ method according to a normal distribution: see Table 6, method 1 in  <cite>Efron B., Tibshirani R. Bootstrap Methods for Standard Errors,
Confidence Intervals, and Other Measures of Statistical Accuracy, Statistical Science Vol.1, No,1, 54-77, 1986</cite>.</p>
<p><strong>Rankings of your samples</strong>
In thid dictionary, the “Percentages” part shows how often a sample was classified correctly
when that sample was in the test set. The number of times the sample was in in the test set is also listed.
Those samples that were always classified correctly or always classified incorrecty are also named, including their ground truth label.</p>
<p><strong>The metric values for each train-test cross-validation iteration</strong>
These are where the confidence intervals are based upon.</p>
</div></blockquote>
</li>
<li><p>The configuration used by WORC.</p>
<blockquote>
<div><p>Stored in files <code class="docutils literal notranslate"><span class="pre">config_{type}_{num}.ini</span></code>. These are the result of the fingerprinting of your dataset. The <code class="docutils literal notranslate"><span class="pre">config_all_{num}.ini</span></code> config is used in classification, the other types
are used for feature extraction and are named after the image types you provided. For example, if you provided two image types, <code class="docutils literal notranslate"><span class="pre">['MRI',</span> <span class="pre">'CT']</span></code>, you will get
<code class="docutils literal notranslate"><span class="pre">config_MRI_0.ini</span></code> and <code class="docutils literal notranslate"><span class="pre">config_CT_0.ini</span></code>. If you provide multiple of the same types, the numbers will change. The fields correspond with those from <a class="reference internal" href="configuration.html#config-chapter"><span class="std std-ref">configuration chapter</span></a>.</p>
</div></blockquote>
</li>
<li><p>The fitted models.</p>
<blockquote>
<div><p>Stored in file <code class="docutils literal notranslate"><span class="pre">estimator_all_{num}.hdf5</span></code>. Contains a pandas dataframe, with inside a pandas series per label for which WORC fitted a model, commonly just one.
The series contains the following attributes:</p>
<ul class="simple">
<li><p>classifiers: a list with per train-test cross-validation, the fitted model on the training set. These are thus the actually fitted models.</p></li>
<li><p>X_train: a list with per train-test cross-validation, a list with for each sample in the training set all feature values. These can be used in re-fitting.</p></li>
<li><p>Y_train: a list with per train-test cross-validation, a list with for each sample in the training set the ground truth labels. These can be used in re-fitting.</p></li>
<li><p>patient_ID_train: a list with per train-test cross-validation, a list with the labels of all samples included in the training set.</p></li>
<li><p>X_test: a list with per train-test cross-validation, a list with for each sample in the test set all feature values. These can be used in re-fitting.</p></li>
<li><p>X_test: a list with per train-test cross-validation, a list with for each sample in the test set the ground truth labels. These can be used in re-fitting.</p></li>
<li><p>patient_ID_test: a list with per train-test cross-validation, a list with the labels of all samples included in the test set.</p></li>
<li><p>config: the WORC config used. Corresponds to the <code class="docutils literal notranslate"><span class="pre">config_all_{num}.ini</span></code> file mentioned above.</p></li>
<li><p>random-seed: a list with per train-test cross-validation, the random seed used in splitting the train and test dataset.</p></li>
<li><p>feature_labels: the names of the features. As these are the same for all samples, only one set is provided.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The extracted features.</p>
<blockquote>
<div><p>Stored in the <code class="docutils literal notranslate"><span class="pre">Features</span></code> folder, in the files <code class="docutils literal notranslate"><span class="pre">features_{featuretoolboxname}_{image_type}_{num}_{sample_id}.hdf5</span></code>. Contains a pandas series with the following attributes:</p>
<ul class="simple">
<li><p>feature_labels: the labels or names of the features.</p></li>
<li><p>feature_values: the value of the features. Each element corresponds with the same element from the feature_labels attribute.</p></li>
<li><p>parameters: the parameters used in the feature extraction. Originate from the WORC config.</p></li>
<li><p>image_type: the type of the image that was used, which you as user provided. Used in the feature labels to distinguish between features extracted from different images.</p></li>
</ul>
</div></blockquote>
</li>
</ol>
<p>The following outputs and evaluation methods are only created when <code class="docutils literal notranslate"><span class="pre">WORC.add_evaluation()</span></code> is used (similar for <code class="docutils literal notranslate"><span class="pre">SimpleWORC</span></code> and <code class="docutils literal notranslate"><span class="pre">BasicWORC</span></code>),
and are stored in the <code class="docutils literal notranslate"><span class="pre">Evaluation</span></code> in the output folder of your experiment.</p>
<ol class="arabic">
<li><p>Receiver Operating Characteristic (ROC) and Precision-Recall (PR) curves.</p>
<p>Stored in files <code class="docutils literal notranslate"><span class="pre">ROC_all_{num}.{ext}</span></code> and <code class="docutils literal notranslate"><span class="pre">PRC_all_{num}.{ext}</span></code>. For each curve, a <code class="docutils literal notranslate"><span class="pre">.png</span></code> is generated for previewing, a <code class="docutils literal notranslate"><span class="pre">.tex</span></code> with tikzplotlib
which can be used to plot the figure in LateX in high quality, and a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> with the confidence intervals so you can easily check these.</p>
<blockquote>
<div><p>95% confidence bands are constructured using the fixed-width bands method from <cite>Macskassy S. A., Provost F., Rosset S. ROC Confidence Bands: An Empirical Evaluation. In: Proceedings of the 22nd international conference on Machine learning. 2005.</cite></p>
</div></blockquote>
</li>
<li><p>Univariate statistical testing of the features.</p>
<blockquote>
<div><p>Stored in files <code class="docutils literal notranslate"><span class="pre">StatisticalTestFeatures_all_{num}.{ext}</span></code>. A <code class="docutils literal notranslate"><span class="pre">.png</span></code> is generated for previewing, a <code class="docutils literal notranslate"><span class="pre">.tex</span></code> with tikzplotlib
which can be used to plot the figure in LateX in high quality, and a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> with the p-values.</p>
<p>The following statistical tests are used:</p>
<ol class="loweralpha simple">
<li><p>A student t-test</p></li>
<li><p>A Welch test</p></li>
<li><p>A Wilcoxon test</p></li>
<li><p>A Mann-Whitney U test</p></li>
</ol>
<p>The uncorrected p-values for all these tests are reported in a the .csv. Pick the right test and significance
level based on your assumptions.</p>
<p>Normally, we make use of the Mann-Whitney U test, as our features do not have to be normally
distributed, it’s nonparametric, and assumes independent samples. Additionally, generally correction should be done
for multiple testing, which we always do with Bonferonni correction. Hence, .png and .tex files contain the
p-values of the Mann-Whitney U; the p-value of the magenta statistical significance has been corrected with
Bonferonni correction.</p>
</div></blockquote>
</li>
<li><p>Overview of hyperparameters used in the top ranked models.</p>
<blockquote>
<div><p>Stored in file <code class="docutils literal notranslate"><span class="pre">Hyperparameters_all_{num}.csv</span></code>.</p>
<p>Each row corresponds with the hyperparameters of one workflow. The following information is displayed in the respective columns:</p>
<ol class="upperalpha simple">
<li><p>The cross-validation iteration.</p></li>
<li><p>The rank of that workflow in that cross-validation.</p></li>
<li><p>The metric on which the ranking in column B was based.</p></li>
<li><p>The mean score on the validation datasets in the nested cross-validation of the metric in column C.</p></li>
<li><p>The mean score on the training datasets in the nested cross-validation of the metric in column C.</p></li>
<li><p>The mean time it took to fit that workflow in the validation datasets.</p></li>
<li><p>and further: the actual hyperparameters.</p></li>
</ol>
<p>For how many of the top ranked workflows the hyperparameters are included in this file depends on the <code class="docutils literal notranslate"><span class="pre">config[&quot;Ensemble&quot;][&quot;Size&quot;]</span></code>, see <a class="reference internal" href="configuration.html#config-chapter"><span class="std std-ref">configuration chapter</span></a>.</p>
</div></blockquote>
</li>
<li><p>Boxplots of the features.</p>
<blockquote>
<div><p>Stored in <code class="docutils literal notranslate"><span class="pre">BoxplotsFeatures_all_{num}.zip</span></code>. The .zip files contains multiple .png files, each with maximum 25 boxplots of features.</p>
<p>For the full <strong>training</strong> dataset (i.e., if a separate test-set is provided, this is not included in these plots.), per features, one boxplot
is generated depicting the distribution of features for all samples (blue), and for binary classification, also only for the samples
with label 0 (green) and for the samples with label 1 (red). Hence, this gives an impression whether some features show major differences
in the distribution among the different classes, and thus could be useful in the classification to separate them.</p>
</div></blockquote>
</li>
<li><p>Ranking patients from typical to atypical as determined by the model.</p>
<blockquote>
<div><p>Stored in files <code class="docutils literal notranslate"><span class="pre">RankedPosteriors_all_{num}.{ext}</span></code> and <code class="docutils literal notranslate"><span class="pre">RankedPercentages_all_{num}.{ext}</span></code>.</p>
<p>Two types of rankings are done:</p>
<p>a. The percentage of times a patient was classified correctly when occuring in the test set. Patients always correctly classified
can be seen as typical examples; patients always classified incorrectly as atypical.
b. The mean posterior of the patient when occuring in the test set.</p>
<p>These measures can only be used in classification. Besides a .csv with the rankings, snapshots of the middle slice
of the image + segmentation are saved with the ground truth label and the percentage/posterior in the filename in
a .zip file. In this way, one can scroll through the patients from typical to atypical to distinguish a pattern.</p>
</div></blockquote>
</li>
<li><p>A barchart of how often certain features groups or feature selection groups were selected in the optimal methods.</p>
<blockquote>
<div><p>Stored in files <code class="docutils literal notranslate"><span class="pre">Barchart_all_{num}.{ext}</span></code>. A <code class="docutils literal notranslate"><span class="pre">.png</span></code> is generated for previewing, a <code class="docutils literal notranslate"><span class="pre">.tex</span></code> with tikzplotlib
which can be used to plot the figure in LateX in high quality.</p>
<p>Gives an idea of which features are most relevant for the predictions of the model, and which feature methods are often succesful.
The overview of the hyperparameters, see above, is more quantitative and useful however.</p>
</div></blockquote>
</li>
<li><p>Decomposition of your feature space.</p>
<blockquote>
<div><p>Stored in file <code class="docutils literal notranslate"><span class="pre">Decomposition_all_{num}.png</span></code>.</p>
<p>The following decompositions are performed:</p>
<ol class="loweralpha simple">
<li><p>Principle Component Analysis (PCA)</p></li>
<li><p>Sparse PCA</p></li>
<li><p>Kernel PCA: linear kernel</p></li>
<li><p>Kernel PCA: polynomial kernel</p></li>
<li><p>Kernel PCA: radial basis function kernel</p></li>
<li><p>t-SNE</p></li>
</ol>
<p>A decomposition can help getting insight into how your dataset can be separated. for example, if the
regular PCA shows good separation of your classes, your classes can be split using linear combinations
of your features.</p>
</div></blockquote>
</li>
</ol>
<p>To add the evaluation workflow, simply use the <code class="docutils literal notranslate"><span class="pre">add_evaluation</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">WORC</span>
<span class="n">experiment</span> <span class="o">=</span> <span class="n">WORC</span><span class="o">.</span><span class="n">WORC</span><span class="p">(</span><span class="s1">&#39;somename&#39;</span><span class="p">)</span>
<span class="n">label_type</span> <span class="o">=</span> <span class="s1">&#39;name_of_label_predicted_for_evaluation&#39;</span>
<span class="o">...</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">add_evaluation</span><span class="p">(</span><span class="n">label_type</span><span class="p">)</span>
</pre></div>
</div>
<p>Or in the <code class="docutils literal notranslate"><span class="pre">SimpleWORC</span></code> or <code class="docutils literal notranslate"><span class="pre">BasicWORC</span></code> facades:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">WORC</span> <span class="kn">import</span> <span class="n">SimpleWORC</span>
<span class="n">experiment</span> <span class="o">=</span> <span class="n">SimpleWORC</span><span class="p">(</span><span class="s1">&#39;somename&#39;</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">add_evaluation</span><span class="p">()</span>
</pre></div>
</div>
<p>The following outputs are only generated if certain configuration settings are used:</p>
<ol class="arabic">
<li><p>Adjusted segmentations.</p>
<blockquote>
<div><p>Stored in the <code class="docutils literal notranslate"><span class="pre">Segmentations</span></code> folder, in the files <code class="docutils literal notranslate"><span class="pre">seg__{image_type}_{num}_{howsegmentationwasgenerated}_{sample_id}.hdf5</span></code>.
Only generated when the original segmentations were modified, e.g. using WORC’s internal program segmentix
(see relevant section of the <a class="reference internal" href="configuration.html#config-chapter"><span class="std std-ref">configuration chapter</span></a>) or when registration was
performed to warp the segmentations from one sequence to another.</p>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>For some of the most frequently occuring issues and answers, see the  <a class="reference internal" href="faq.html#faq-chapter"><span class="std std-ref">WORC FAQ</span></a>).
As WORC is based on fastr, debugging is similar to debugging a fastr pipeline: see therefore also
<a class="reference external" href="https://fastr.readthedocs.io/en/stable/static/user_manual.html#debugging/">the fastr debugging guidelines</a>.
If you run into any issue, please create an issue on the <a class="reference external" href="https://github.com/MStarmans91/WORC/issues/">WORC Github</a>.</p>
<p>We advise you to follow the fastr debugging guide, but for convenience provide here an adoptation of
“Debugging a Network run with errors” with a WORC example.</p>
<p>If a Network run did finish but there were errors detected, Fastr will report those
at the end of the execution. An example of the output of a Network run with failures:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">networkrun</span><span class="p">:</span><span class="mi">0688</span> <span class="o">&gt;&gt;</span> <span class="c1">####################################</span>
 <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">networkrun</span><span class="p">:</span><span class="mi">0689</span> <span class="o">&gt;&gt;</span> <span class="c1">#    network execution FINISHED    #</span>
 <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">networkrun</span><span class="p">:</span><span class="mi">0690</span> <span class="o">&gt;&gt;</span> <span class="c1">####################################</span>
 <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">simplereport</span><span class="p">:</span><span class="mi">0026</span> <span class="o">&gt;&gt;</span> <span class="o">=====</span> <span class="n">RESULTS</span> <span class="o">=====</span>
 <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">simplereport</span><span class="p">:</span><span class="mi">0036</span> <span class="o">&gt;&gt;</span> <span class="n">classification</span><span class="p">:</span> <span class="mi">0</span> <span class="n">success</span> <span class="o">/</span> <span class="mi">0</span> <span class="n">missing</span> <span class="o">/</span> <span class="mi">1</span> <span class="n">failed</span>
 <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">simplereport</span><span class="p">:</span><span class="mi">0036</span> <span class="o">&gt;&gt;</span> <span class="n">config_CT_0_sink</span><span class="p">:</span> <span class="mi">1</span> <span class="n">success</span> <span class="o">/</span> <span class="mi">0</span> <span class="n">missing</span> <span class="o">/</span> <span class="mi">0</span> <span class="n">failed</span>
 <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">simplereport</span><span class="p">:</span><span class="mi">0036</span> <span class="o">&gt;&gt;</span> <span class="n">config_classification_sink</span><span class="p">:</span> <span class="mi">1</span> <span class="n">success</span> <span class="o">/</span> <span class="mi">0</span> <span class="n">missing</span> <span class="o">/</span> <span class="mi">0</span> <span class="n">failed</span>
 <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">simplereport</span><span class="p">:</span><span class="mi">0036</span> <span class="o">&gt;&gt;</span> <span class="n">features_train_CT_0_predict</span><span class="p">:</span> <span class="mi">19</span> <span class="n">success</span> <span class="o">/</span> <span class="mi">0</span> <span class="n">missing</span> <span class="o">/</span> <span class="mi">1</span> <span class="n">failed</span>
 <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">simplereport</span><span class="p">:</span><span class="mi">0036</span> <span class="o">&gt;&gt;</span> <span class="n">performance</span><span class="p">:</span> <span class="mi">0</span> <span class="n">success</span> <span class="o">/</span> <span class="mi">0</span> <span class="n">missing</span> <span class="o">/</span> <span class="mi">1</span> <span class="n">failed</span>
 <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">simplereport</span><span class="p">:</span><span class="mi">0036</span> <span class="o">&gt;&gt;</span> <span class="n">segmentations_out_segmentix_train_CT_0</span><span class="p">:</span> <span class="mi">20</span> <span class="n">success</span> <span class="o">/</span> <span class="mi">0</span> <span class="n">missing</span> <span class="o">/</span> <span class="mi">0</span> <span class="n">failed</span>
 <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">simplereport</span><span class="p">:</span><span class="mi">0037</span> <span class="o">&gt;&gt;</span> <span class="o">===================</span>
 <span class="p">[</span><span class="n">WARNING</span><span class="p">]</span> <span class="n">simplereport</span><span class="p">:</span><span class="mi">0049</span> <span class="o">&gt;&gt;</span> <span class="n">There</span> <span class="n">were</span> <span class="n">failed</span> <span class="n">samples</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">run</span><span class="p">,</span> <span class="n">to</span> <span class="n">start</span> <span class="n">debugging</span> <span class="n">you</span> <span class="n">can</span> <span class="n">run</span><span class="p">:</span>

    <span class="n">fastr</span> <span class="n">trace</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">Martijn</span> <span class="n">Starmans</span>\<span class="n">Documents</span>\<span class="n">GitHub</span>\<span class="n">WORCTutorial</span>\<span class="n">WORC_Example_STWStrategyHN</span>\<span class="n">__sink_data__</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="n">sinks</span>

<span class="n">see</span> <span class="n">the</span> <span class="n">debug</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">manual</span> <span class="n">at</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">fastr</span><span class="o">.</span><span class="n">readthedocs</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">en</span><span class="o">/</span><span class="n">develop</span><span class="o">/</span><span class="n">static</span><span class="o">/</span><span class="n">user_manual</span><span class="o">.</span><span class="n">html</span><span class="c1">#debugging for more information.</span>
</pre></div>
</div>
<p>Fastr reports errors per sink, which are the outputs expected of the network, e.g., feature files and a classification model in WORC. Per sink, there
can be one or multiple samples / patients that failed. A sink / output failing can be due to multiple nodes in the network: if the classification model
is not generated, it could be that the model fitting failed, but also a feature extraction node somewhere earlier in the pipeline. Hence I would
advice to start with a sink that’s a result of a node early in the pipeline. You will also see this difference in the output that fastr gives,
as some jobs have actually failed, while some have been cancelled because other jobs before that have failed.
If you have graphviz installed, fastr will draw an image of the full WORC network you are running so you can identify this, see
<a class="reference external" href="https://github.com/MStarmans91/WORC/tree/master/WORC/exampledata/WORC_Example_STWStrategyHN.svg">https://github.com/MStarmans91/WORC/tree/master/WORC/exampledata/WORC_Example_STWStrategyHN.svg</a> for an example.</p>
<p>In the above example, we thus want to start with the <code class="docutils literal notranslate"><span class="pre">features_train_CT_0_predict</span></code> sink. Also you already get
the suggestion to use <span class="xref std std-ref">fastr trace</span>. This command helps you inspect the staging directory of the Network run
and pinpoint the errors. To get a very detailed error report we have to specify one sink and one sample.
To see which samples have failed, we run the <code class="docutils literal notranslate"><span class="pre">fastr</span> <span class="pre">trace</span></code> command with the <code class="docutils literal notranslate"><span class="pre">--samples</span></code> option</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">VEWORC</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">Martijn</span> <span class="n">Starmans</span>\<span class="n">Documents</span>\<span class="n">GitHub</span>\<span class="n">WORCTutorial</span><span class="o">&gt;</span><span class="n">fastr</span> <span class="n">trace</span> <span class="s2">&quot;C:\Users\Martijn Starmans\Documents\GitHub\WORCTutorial\WORC_Example_STWStrategyHN\__sink_data__.json&quot;</span> <span class="o">--</span><span class="n">samples</span>
 <span class="p">[</span><span class="n">WARNING</span><span class="p">]</span>  <span class="fm">__init__</span><span class="p">:</span><span class="mi">0084</span> <span class="o">&gt;&gt;</span> <span class="n">Not</span> <span class="n">running</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">production</span> <span class="n">installation</span> <span class="p">(</span><span class="n">branch</span> <span class="s2">&quot;unknown&quot;</span> <span class="kn">from</span> <span class="nn">installed</span> <span class="n">package</span><span class="p">)</span>
<span class="n">HN1004</span> <span class="o">--</span> <span class="mi">1</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">1</span> <span class="n">succeeded</span>
<span class="n">HN1077</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1088</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1146</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1159</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1192</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1259</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1260</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1323</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1331</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1339</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1342</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1372</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1491</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1501</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1519</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1524</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1554</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1560</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="n">HN1748</span> <span class="o">--</span> <span class="mi">0</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
<span class="nb">all</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">failed</span> <span class="o">--</span> <span class="mi">2</span> <span class="n">succeeded</span>
</pre></div>
</div>
<p>You will recognize the names you gave to the samples. Per sample, you will see in how many sinks they have failed.
In this case, the <code class="docutils literal notranslate"><span class="pre">segmentations_out_segmentix_train_CT_0</span></code> sink was succesfully generated for all samples,
but our <code class="docutils literal notranslate"><span class="pre">features_train_CT_0_predict</span></code> failed. Note that the <code class="docutils literal notranslate"><span class="pre">all</span></code> sample is when we combine all patients, e.g.,
in the classification node. In this case, only one sample failed, HN1004.</p>
<p>Now we run the <code class="docutils literal notranslate"><span class="pre">fastr</span> <span class="pre">trace</span></code> command for our specific sink and a specific sample print a complete error
report for that job:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(VEWORC) C:\Users\Martijn Starmans\Documents\GitHub\WORCTutorial&gt;fastr trace &quot;C:\Users\Martijn Starmans\Documents\GitHub\WORCTutorial\WORC_Example_STWStrategyHN\__sink_data__.json&quot; --sinks features_train_CT_0_predict --samples HN1004
 [WARNING]  __init__:0084 &gt;&gt; Not running in a production installation (branch &quot;unknown&quot; from installed package)
Tracing errors for sample HN1004 from sink features_train_CT_0_predict
Located result pickle: C:\Users\Martijn Starmans\Documents\GitHub\WORCTutorial\WORC_Example_STWStrategyHN\calcfeatures_train_predict_CalcFeatures_1_0_CT_0\HN1004\__fastr_result__.yaml

===== JOB WORC_Example_STWStrategyHN___calcfeatures_train_predict_CalcFeatures_1_0_CT_0___HN1004 =====
Network: WORC_Example_STWStrategyHN
Run: WORC_Example_STWStrategyHN_2023-08-11T16-59-52
Node: calcfeatures_train_predict_CalcFeatures_1_0_CT_0
Sample index: (0)
Sample id: HN1004
Status: JobState.execution_failed
Timestamp: 2023-08-11 15:01:15.442376
Job file: C:\Users\Martijn Starmans\documents\github\worctutorial\worc_example_stwstrategyhn\calcfeatures_train_predict_CalcFeatures_1_0_CT_0\HN1004\__fastr_result__.yaml

----- ERRORS -----
- FastrOutputValidationError: Output value [HDF5] &quot;vfs://home/documents\github\worctutorial\worc_example_stwstrategyhn\calcfeatures_train_predict_calcfeatures_1_0_ct_0\hn1004\features_0.hdf5&quot; not valid for datatype &quot;&#39;HDF5&#39;&quot; (C:\Users\Martijn Starmans\.conda\envs\VEWORC\lib\site-packages\fastr\execution\job.py:1155)
- FastrOutputValidationError: The output &quot;features&quot; is invalid! (C:\Users\Martijn Starmans\.conda\envs\VEWORC\lib\site-packages\fastr\execution\job.py:1103)
- FastrErrorInSubprocess: C:\Users\Martijn Starmans\.conda\envs\VEWORC\lib\site-packages\phasepack\tools.py:14: UserWarning:
Module &#39;pyfftw&#39; (FFTW Python bindings) could not be imported. To install it, try
running &#39;pip install pyfftw&#39; from the terminal. Falling back on the slower
&#39;fftpack&#39; module for 2D Fourier transforms.
  &#39;fftpack&#39; module for 2D Fourier transforms.&quot;&quot;&quot;)
Traceback (most recent call last):
  File &quot;c:\users\martijn starmans\documents\github\worc\WORC\resources\fastr_tools\predict\bin\CalcFeatures_tool.py&quot;, line 72, in &lt;module&gt;
    main()
  File &quot;c:\users\martijn starmans\documents\github\worc\WORC\resources\fastr_tools\predict\bin\CalcFeatures_tool.py&quot;, line 68, in main
    semantics_file=args.sem)
  File &quot;c:\users\martijn starmans\documents\github\predictfastr\PREDICT\CalcFeatures.py&quot;, line 109, in CalcFeatures
    raise ae.PREDICTIndexError(message)
PREDICT.addexceptions.PREDICTIndexError: Shapes of image((512, 512, 147)) and mask ((512, 512, 134)) do not match!
 (C:\Users\Martijn Starmans\.conda\envs\VEWORC\lib\site-packages\fastr\execution\executionscript.py:111)
- FastrValueError: Output values are not valid! (C:\Users\Martijn Starmans\.conda\envs\VEWORC\lib\site-packages\fastr\execution\job.py:834)
------------------

Command:
List representation: [&#39;python&#39;, &#39;c:\\users\\martijn starmans\\documents\\github\\worc\\WORC\\resources\\fastr_tools\\predict\\bin\\CalcFeatures_tool.py&#39;, &#39;--im&#39;, &#39;C:\\Users\\Martijn Starmans\\documents\\github\\worctutorial\\worc_example_stwstrategyhn\\preprocessing_train_ct_0\\hn1004\\image_0.nii.gz&#39;, &#39;--out&#39;, &#39;C:\\Users\\Martijn Starmans\\documents\\github\\worctutorial\\worc_example_stwstrategyhn\\calcfeatures_train_predict_CalcFeatures_1_0_CT_0\\HN1004\\features_0.hdf5&#39;, &#39;--seg&#39;, &#39;C:\\Users\\Martijn Starmans\\documents\\github\\worctutorial\\worc_example_stwstrategyhn\\segmentix_train_ct_0\\hn1004\\segmentation_out_0.nii.gz&#39;, &#39;--para&#39;, &#39;C:\\Users\\Martijn Starmans\\documents\\github\\worctutorial\\worc_example_stwstrategyhn\\fingerprinter_ct_0\\all\\config_0.ini&#39;]

String representation: python ^&quot;c:\users\martijn starmans\documents\github\worc\WORC\resources\fastr_tools\predict\bin\CalcFeatures_tool.py^&quot; --im ^&quot;C:\Users\Martijn Starmans\documents\github\worctutorial\worc_example_stwstrategyhn\preprocessing_train_ct_0\hn1004\image_0.nii.gz^&quot; --out ^&quot;C:\Users\Martijn Starmans\documents\github\worctutorial\worc_example_stwstrategyhn\calcfeatures_train_predict_CalcFeatures_1_0_CT_0\HN1004\features_0.hdf5^&quot; --seg ^&quot;C:\Users\Martijn Starmans\documents\github\worctutorial\worc_example_stwstrategyhn\segmentix_train_ct_0\hn1004\segmentation_out_0.nii.gz^&quot; --para ^&quot;C:\Users\Martijn Starmans\documents\github\worctutorial\worc_example_stwstrategyhn\fingerprinter_ct_0\all\config_0.ini^&quot;


Output data:
{&#39;features&#39;: [&lt;HDF5: &#39;vfs://home/documents\\github\\worctutorial\\worc_example_stwstrategyhn\\calcfeatures_train_predict_calcfeatures_1_0_ct_0\\hn1004\\features_0.hdf5&#39;&gt;]}

Status history:
2023-08-11 15:01:15.442376: JobState.created
2023-08-11 15:01:15.451894: JobState.hold
2023-08-11 15:04:21.852828: JobState.queued
2023-08-11 15:05:21.169469: JobState.running
2023-08-11 15:05:28.904541: JobState.execution_failed

----- STDOUT -----
Loading inputs.
Load image and metadata file.
Load semantics file.
Load segmentation.
Shapes of image((512, 512, 147)) and mask ((512, 512, 135)) do not match!

------------------

----- STDERR -----
Traceback (most recent call last):
  File &quot;c:\users\martijn starmans\documents\github\worc\WORC\resources\fastr_tools\predict\bin\CalcFeatures_tool.py&quot;, line 72, in &lt;module&gt;
    main()
  File &quot;c:\users\martijn starmans\documents\github\worc\WORC\resources\fastr_tools\predict\bin\CalcFeatures_tool.py&quot;, line 68, in main
    semantics_file=args.sem)
  File &quot;c:\users\martijn starmans\documents\github\predictfastr\PREDICT\CalcFeatures.py&quot;, line 109, in CalcFeatures
    raise ae.PREDICTIndexError(message)
PREDICT.addexceptions.PREDICTIndexError: Shapes of image((512, 512, 147)) and mask ((512, 512, 134)) do not match!

------------------
</pre></div>
</div>
<p>As shown above, it finds the result files of the failed job(s) and prints the most important information. The first
paragraph shows the information about the Job that was involved. The second paragraph shows the exact calling command
that fastr was trying to execute for this job, both as a list (which is clearer and internally used in Python) and
as a string (which you can copy/paste to the shell to test the command and should reproduce the exact error encounteres, nice for debugging if you make changes in the code).
Then there is the output data as determined by Fastr. The next section shows the status history of the
Job which can give an indication about wait and run times. At the bottom, the stdout and stderr of the
subprocess are printed.</p>
<p>But the section we are most interested in, is the Error section, which lists the errors that Fastr encounted during the
execution of the Job. Note that the second FastrValueError is a general error fastr returns when a job failed:
since there is no output generated, the output values are obviously not valid for what fastr expected. Hence that
does not give you any input on why the job failed. What you want is the actual error that occured in the tool, e.g.,
the Python error. In this case, that’s the PREDICT.addexceptions.PREDICTIndexError, which tells us that the mask
that we provided for feature extraction had a different shape then the image.</p>
<p>Once you’ve solved the issues, you can just relaunch the experiment. WORC/fastr saves the temporary output files
and will thus continue where it left of, only checking for all jobs that were previously finished whether
the output is still there.</p>
</div>
<div class="section" id="example-data">
<h2>Example data<a class="headerlink" href="#example-data" title="Permalink to this headline">¶</a></h2>
<p>For many files used in typical WORC experiments, we provide example data. Some
of these can be found in the exampledata folder within the WORC package:
<a class="reference external" href="https://github.com/MStarmans91/WORC/tree/master/WORC/exampledata">https://github.com/MStarmans91/WORC/tree/master/WORC/exampledata</a>. To
save memory, for several types the example data is not included, but a script
is provided to create the example data. This script (<code class="docutils literal notranslate"><span class="pre">create_example_data</span></code>) can
be found in the exampledata folder as well.</p>
<div class="section" id="worc">
<span id="id3"></span><h3>WORC<a class="headerlink" href="#worc" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">WORC</span></code> object can also directly be assessed, but we don’t recommend this as the facades adds
a lot of functionality plus the WORC object can still be direclty accessed through the facades.
for completeness, we give some documentation here.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">WORC</span></code> object can  directly be accessed in the following way:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">WORC</span>
<span class="n">network</span> <span class="o">=</span> <span class="n">WORC</span><span class="o">.</span><span class="n">WORC</span><span class="p">(</span><span class="s1">&#39;somename&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>It’s attributes are split in a couple of categories. We will not discuss
the <code class="docutils literal notranslate"><span class="pre">WORC.defaultconfig()</span></code> function here, which generates the default
configuration, as it is listed in a separate page, see the <a class="reference internal" href="configuration.html#config-chapter"><span class="std std-ref">Config chapter</span></a>.
More detailed documentation of the various functions can be found in the docstrings of <a class="reference internal" href="../autogen/WORC.html#module-WORC.WORC" title="WORC.WORC"><code class="xref py py-mod docutils literal notranslate"><span class="pre">WORC.WORC</span></code></a>:
we will mostly focus on the attributes, inputs, outputs and workflows here.</p>
<p>There are numerous <code class="docutils literal notranslate"><span class="pre">WORC</span></code> attributes which serve as source nodes (i.e. inputs) for the
FASTR experiment. These are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">images_train</span></code> and <code class="docutils literal notranslate"><span class="pre">images_test</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">segmentations_train</span></code> and <code class="docutils literal notranslate"><span class="pre">segmentations_test</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">semantics_train</span></code> and <code class="docutils literal notranslate"><span class="pre">semantics_test</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">labels_train</span></code> and <code class="docutils literal notranslate"><span class="pre">labels_test</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">masks_train</span></code> and <code class="docutils literal notranslate"><span class="pre">masks_test</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">features_train</span></code> and <code class="docutils literal notranslate"><span class="pre">features_test</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metadata_train</span></code> and <code class="docutils literal notranslate"><span class="pre">metadata_test</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Elastix_Para</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fastrconfigs</span></code></p></li>
</ul>
</div></blockquote>
<p>These directly correspond to the <a class="reference internal" href="#inputs"><span class="std std-ref">input file definitions discussed below</span></a>
How to provide your data to <code class="docutils literal notranslate"><span class="pre">WORC</span></code> is also described in this section.</p>
<p>After supplying your sources as described above, you need to build the FASTR experiment. This
can be done through the <code class="docutils literal notranslate"><span class="pre">WORC.build()</span></code> command. Depending on your sources,
several nodes will be added and linked. This creates the <code class="docutils literal notranslate"><span class="pre">WORC.network</span></code>
object, which is a <code class="docutils literal notranslate"><span class="pre">fastr.network</span></code> object. You can edit this network
freely, e.g. add another source or node. You can print the network with
the <code class="docutils literal notranslate"><span class="pre">WORC.experiment.draw_network</span></code> command.</p>
<p>Next, we have to tell the network which sources should be used in the
source nodes. This can be done through the <code class="docutils literal notranslate"><span class="pre">WORC.set()</span></code> function. This will
put your supplied sources into the source nodes and also creates the
needed sink nodes. You can check these by looking at the created
<code class="docutils literal notranslate"><span class="pre">WORC.source_data</span></code> and <code class="docutils literal notranslate"><span class="pre">WORC.sink_data</span></code> objects.</p>
<p>Finally, after completing above steps, you can execute the network
through the <code class="docutils literal notranslate"><span class="pre">WORC.execute()</span></code> command.</p>
<p>Thus a typical experiment in <code class="docutils literal notranslate"><span class="pre">WORC</span></code> would follow the following structure,
assuming you have created the relevant objects as listed above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">WORC</span>

<span class="c1"># Create object</span>
<span class="n">experiment</span> <span class="o">=</span> <span class="n">WORC</span><span class="o">.</span><span class="n">WORC</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>

<span class="c1"># Append sources</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">images_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images_train</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">segmentations_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segmentations_train</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">labels_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_train</span><span class="p">)</span>

<span class="c1"># Create a configuration</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">defaultconfig</span><span class="p">()</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># Build, set, and execute</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="configuration.html" class="btn btn-neutral float-right" title="Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="quick_start.html" class="btn btn-neutral float-left" title="Quick start guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016 -- 2023, Biomedical Imaging Group Rotterdam, Department of Radiology and Nuclear Medicine, Erasmus University Medical Center, Rotterdam, The Netherlands.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>